language: minimal
services: docker
env:
  matrix:
  - DOCKER_COMPOSE_VERSION=1.23.2
  global:
  - secure: Ju1w1SJT9LZUF4A8XRzvDhZoVxHVOE3pM9gJ4D0wFh4UXhyRE3rCwWGOeKaqd/fSjOx9P13ffktnJ8Y3Qj0+lPjUwR2SRisomTiejA79mffv5QjPiZZD6+KIQnk7LQqJ7kb8bDECcq/gzh/kHGQcrCxT9ZpCnzfLifUOKtpZvHWlRB1++81DDmAW0EdsLqOCAXUDG+l2EH75oL/ij1boe0QnumL7XuIvXBc8X9UxgLIoY9A3dRufmQC4qRTRUvn0Okc9aVEDjehGiQeneSSY0W5s+4xDCXeuVX+ot9u0mdb31FsI0ullRr9Vjl1On2xuIUr6lwMDKHNPr27XYLZYXLaNokw+VuTG4Dw5hpKKeXCPQPgZLxoNLMNWl7xcIrYIGAH0nqSvZ5afTFy0JZbIDDorh2R6qZ7+bwOzsdUhp2y/yjzymz8a4WjL+M9lAmMNL5L4Ocacqpv9oVZYfaCHtG4kQFLoak6kU25mZE08NK7amSxbyYe7MLi83trqScRQSMS+afuJO9NTML7d9OcV927Vwxdfpl1swpL800I18n22Ep/+yno6zmRIl2ZZ0D5P1JMS0YxDEvny7y/Gy/3daYPB57GWtsE5PePEE+hpHx3/gzaFFSEaKvWyHHIWWQoA5hfLN9rVlg+w5aSngubzvShTQA0z+zgUqpbqHA04BvA=
  - secure: wS05hXTHnwTESXCO0aQC1z8jrdqN7b2yiMWBiO+LOHGerxdpBNaOc3MdcGN4jwgXT5YUTUUgI/tc+5rVbEmsi1Mr49KDUGn42I/C6ziYa50ssHhQKmjB3u1+Ybt5jDt4VWxOKWdgJ8TRLbYuUy+Y0MuLBl6xd8QmvFp7kXK4NQKGjhHIBH59o4N71g8ylJwL+u3z/S0XAbKpYGzIXXXgUhgy4dBlXeNrKlZ/xf3pMpOVg0nJ+zulr0xwMR0jP0nCTXuuOSpb6L4RE8YtjTmoOP2wQ8/oQONc50SoBe1tQiXNVjd/gRRKYBs/C9ENAbIA5DHn87hswVhw3MSNmvti9vaTQy1DFxmxPMc2zZqLKYZWowj+LWiWuyk7R86BudS2Y8YvwsgzfPBWyFsKoLw8C8hcvvxtWbEH6hpaREsU+X2qA9SZqotNrENdVo5tlez/RpeTlLhGS2z963fdvWFXVtBMIsvgMDGCA5QszA4AanyhN+CTEQ8nJajccxeq45CImwXyI5M/CmoSS3M8lZBlg44Jfa4IxGAZzoHk0i2Sy9qzjepgAWfLT4TUO854MqwhROjTLFGbJftVLFd0sU/vgXpCS3vHilnVhV6bFpXaBCmBv3IF+eJgRWDyRBGzFiXCMcn9CWKP+NCrDhb/n3HP6XpOocZ4tsw0dK/5rUaOq8A=
before_install:
- docker -v && docker-compose -v
- sudo rm /usr/local/bin/docker-compose
- curl -L https://github.com/docker/compose/releases/download/${DOCKER_COMPOSE_VERSION}/docker-compose-`uname
  -s`-`uname -m` > docker-compose
- chmod +x docker-compose
- sudo mv docker-compose /usr/local/bin
- curl -LO https://storage.googleapis.com/kubernetes-release/release/$(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/linux/amd64/kubectl
- chmod +x ./kubectl
- sudo mv ./kubectl /usr/local/bin/kubectl
- echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
- mkdir ${HOME}/.kube
- cp udacity-c3-deployment/k8s/udagram-kubeconfig ${HOME}/.kube/config
install:
- echo 'Hello Udacity..3.'
- docker-compose -f udacity-c3-deployment/docker/docker-compose-build.yaml build --parallel
- docker push jrc294/udacity-restapi-feed
- docker push jrc294/udacity-restapi-user
- docker push jrc294/reverseproxy
- docker push jrc294/udacity-frontend:local
- kubectl apply -f udacity-c3-deployment/k8s/backend-feed-service.yaml
